<!DOCTYPE html>
<html>
<head>
    <title>Product Selector</title>
    <style>
        .product {
            display: inline-block;
            margin: 20px;
            text-align: center;
        }
        .product img {
            width: 150px;
            height: 150px;
            cursor: pointer;
        }
        #productDetails {
            display: none;
            margin-top: 20px;
        }
        .module-container {
            margin: 10px 0;
        }
        .module-label {
            display: inline-block;
            width: 100px;
        }
    </style>
</head>
<body>
    <h1>Product Selector</h1>
    <div id="productContainer"></div>
    <div id="productDetails">
        <h2 id="productName"></h2>
        <p id="moduleInfo"></p>
        <div id="moduleSelectors"></div>
    </div>

    <script>
        const productXML = `
            <products>
                <product id="1">
                    <name>Product 1</name>
                    <image>https://via.placeholder.com/150</image>
                    <maxModules>
                        <A>4</A>
                        <B>3</B>
                    </maxModules>
                </product>
                <product id="2">
                    <name>Product 2</name>
                    <image>https://via.placeholder.com/150</image>
                    <maxModules>
                        <A>6</A>
                        <B>2</B>
                    </maxModules>
                </product>
            </products>
        `;

        const parser = new DOMParser();
        const productDoc = parser.parseFromString(productXML, "application/xml");
        const products = productDoc.getElementsByTagName("product");

        const productContainer = document.getElementById("productContainer");
        const productDetails = document.getElementById("productDetails");
        const productName = document.getElementById("productName");
        const moduleInfo = document.getElementById("moduleInfo");
        const moduleSelectors = document.getElementById("moduleSelectors");

        async function fetchModules() {
            const response = await fetch('modules.xml');
            const text = await response.text();
            const moduleDoc = parser.parseFromString(text, "application/xml");
            const moduleTypes = moduleDoc.getElementsByTagName("type");
            const moduleMap = {};

            Array.from(moduleTypes).forEach(type => {
                const id = type.getAttribute("id");
                const options = Array.from(type.getElementsByTagName("option")).map(opt => opt.textContent);
                moduleMap[id] = options;
            });

            return moduleMap;
        }

        async function initialize() {
            const moduleMap = await fetchModules();

            Array.from(products).forEach(product => {
                const id = product.getAttribute("id");
                const name = product.getElementsByTagName("name")[0].textContent;
                const image = product.getElementsByTagName("image")[0].textContent;
                const maxA = parseInt(product.getElementsByTagName("A")[0].textContent);
                const maxB = parseInt(product.getElementsByTagName("B")[0].textContent);

                const productDiv = document.createElement("div");
                productDiv.className = "product";
                productDiv.innerHTML = `
                    <img src="${image}" alt="${name}" data-id="${id}" />
                    <p>${name}</p>
                `;

                productDiv.querySelector("img").addEventListener("click", () => {
                    showProductDetails(name, maxA, maxB, moduleMap.A, moduleMap.B);
                });

                productContainer.appendChild(productDiv);
            });
        }

        function showProductDetails(name, maxA, maxB, availableA, availableB) {
            productName.textContent = name;
            moduleInfo.textContent = `This product can hold up to ${maxA} A modules and ${maxB} B modules.`;

            moduleSelectors.innerHTML = ""; // Clear previous selectors

            // Create dropdowns for A modules
            for (let i = 0; i < maxA; i++) {
                const moduleDiv = createModuleSelector(`Slot A${i + 1}`, availableA);
                moduleSelectors.appendChild(moduleDiv);
            }

            // Create dropdowns for B modules
            for (let i = 0; i < maxB; i++) {
                const moduleDiv = createModuleSelector(`Slot B${i + 1}`, availableB);
                moduleSelectors.appendChild(moduleDiv);
            }

            productDetails.style.display = "block";
        }

        function createModuleSelector(labelText, options) {
            const container = document.createElement("div");
            container.className = "module-container";

            const label = document.createElement("span");
            label.className = "module-label";
            label.textContent = labelText;

            const select = document.createElement("select");
            options.forEach(option => {
                const opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });

            container.appendChild(label);
            container.appendChild(select);

            return container;
        }

        initialize();
    </script>
</body>
</html>
